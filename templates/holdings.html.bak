{% extends "base.html" %}

{% block title %}Holdings - Portfolio Rebalancer{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">Holdings</h1>

<div class="card">
    <h2>Add New Holding</h2>
    <form method="POST" action="{{ url_for('add_holding') }}">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
            <div class="form-group">
                <label for="account_id">Account</label>
                <select id="account_id" name="account_id" required>
                    <option value="">Select Account</option>
                    {% for account in accounts %}
                    <option value="{{ account.id }}">{{ account.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="ticker">Ticker</label>
                <input type="text" id="ticker" name="ticker" required placeholder="e.g., VTI">
            </div>
            <div class="form-group">
                <label for="quantity">Quantity</label>
                <input type="number" step="0.001" id="quantity" name="quantity" required placeholder="100">
            </div>
            <div class="form-group">
                <label for="price">Price</label>
                <input type="number" step="0.01" id="price" name="price" required placeholder="150.00">
            </div>
            <div class="form-group">
                <label for="asset_class">Asset Class</label>
                <input type="text" id="asset_class" name="asset_class" required placeholder="US Equity">
            </div>
        </div>
        <button type="submit" class="btn btn-success">Add Holding</button>
    </form>
</div>

{% for account in accounts %}
<div class="card">
    <h2>{{ account.name }} {% if account.account_type %}<span style="color: #7f8c8d; font-size: 0.9rem;">({{ account.account_type }})</span>{% endif %}</h2>
    {% if account.holdings %}
    <table>
        <thead>
            <tr>
                <th>Ticker</th>
                <th>Asset Class</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Price</th>
                <th class="text-right">Market Value</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for holding in account.holdings %}
            <tr>
                <td><strong>{{ holding.ticker }}</strong></td>
                <td>{{ holding.asset_class }}</td>
                <td class="text-right">{{ "%.3f"|format(holding.quantity) }}</td>
                <td class="text-right">${{ "%.2f"|format(holding.price) }}</td>
                <td class="text-right"><strong>${{ "%.2f"|format(holding.market_value) }}</strong></td>
                <td>
                    <form method="POST" action="{{ url_for('delete_holding', holding_id=holding.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this holding?');">
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            <tr style="background: #f8f9fa; font-weight: bold;">
                <td colspan="4" class="text-right">Account Total:</td>
                <td class="text-right">${{ "%.2f"|format(account.holdings|sum(attribute='market_value')) }}</td>
                <td></td>
            </tr>
        </tbody>
    </table>
    {% else %}
    <p style="color: #7f8c8d; margin-top: 1rem;">No holdings in this account yet.</p>
    {% endif %}
</div>
{% endfor %}

{% if not accounts %}
<div class="card">
    <p style="color: #7f8c8d;">No accounts yet. <a href="{{ url_for('accounts') }}">Create an account first</a>.</p>
</div>
{% endif %}
{% endblock %}

