{% extends "base.html" %}

{% block title %}Target Allocation - Portfolio Rebalancer{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">Target Allocation</h1>

<div class="card">
    <h2>Set Your Target Asset Allocation</h2>
    <p style="color: #7f8c8d; margin-bottom: 1.5rem;">Define the percentage allocation for each asset class. Total should equal 100%.</p>
    
    <form method="POST" action="{{ url_for('update_targets') }}">
        <div id="targets-container">
            {% if targets %}
                {% for target in targets %}
                <div class="target-row" style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Asset Class</label>
                        <input type="text" name="asset_class_{{ loop.index }}" value="{{ target.asset_class }}" required placeholder="e.g., US Equity">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Target %</label>
                        <input type="number" step="0.1" name="percentage_{{ loop.index }}" value="{{ target.target_percentage }}" required placeholder="25.0">
                    </div>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">Remove</button>
                </div>
                {% endfor %}
            {% else %}
                <div class="target-row" style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Asset Class</label>
                        <input type="text" name="asset_class_1" required placeholder="e.g., US Equity">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Target %</label>
                        <input type="number" step="0.1" name="percentage_1" required placeholder="25.0">
                    </div>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">Remove</button>
                </div>
            {% endif %}
        </div>
        
        <div style="margin-top: 1rem; display: flex; gap: 1rem;">
            <button type="button" class="btn btn-primary" onclick="addTargetRow()">Add Asset Class</button>
            <button type="submit" class="btn btn-success">Save Targets</button>
        </div>
    </form>
</div>

{% if targets %}
<div class="card">
    <h2>Current Target Allocation</h2>
    <table>
        <thead>
            <tr>
                <th>Asset Class</th>
                <th class="text-right">Target %</th>
            </tr>
        </thead>
        <tbody>
            {% for target in targets %}
            <tr>
                <td><strong>{{ target.asset_class }}</strong></td>
                <td class="text-right">{{ "%.1f"|format(target.target_percentage) }}%</td>
            </tr>
            {% endfor %}
            <tr style="background: #f8f9fa; font-weight: bold;">
                <td>Total:</td>
                <td class="text-right">{{ "%.1f"|format(targets|sum(attribute='target_percentage')) }}%</td>
            </tr>
        </tbody>
    </table>
</div>
{% endif %}

<script>
let targetCounter = {{ targets|length if targets else 1 }};

function addTargetRow() {
    targetCounter++;
    const container = document.getElementById('targets-container');
    const row = document.createElement('div');
    row.className = 'target-row';
    row.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr auto; gap: 1rem; margin-bottom: 1rem; align-items: end;';
    row.innerHTML = `
        <div class="form-group" style="margin-bottom: 0;">
            <label>Asset Class</label>
            <input type="text" name="asset_class_${targetCounter}" required placeholder="e.g., Bonds">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <label>Target %</label>
            <input type="number" step="0.1" name="percentage_${targetCounter}" required placeholder="10.0">
        </div>
        <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()">Remove</button>
    `;
    container.appendChild(row);
}
</script>
{% endblock %}

