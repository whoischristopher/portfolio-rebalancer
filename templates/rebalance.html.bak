{% extends "base.html" %}

{% block title %}Rebalance - Portfolio Rebalancer{% endblock %}

{% block content %}
<h1 style="margin-bottom: 2rem;">Rebalance Portfolio</h1>

{% if rebalance_data %}
<div class="card">
    <h2>Portfolio Overview</h2>
    <p style="font-size: 1.5rem; color: #2c3e50;"><strong>Total Portfolio Value:</strong> ${{ "%.2f"|format(total_portfolio) }}</p>
</div>

<div class="card">
    <h2>Rebalancing Analysis</h2>
    <table>
        <thead>
            <tr>
                <th>Asset Class</th>
                <th class="text-right">Current Value</th>
                <th class="text-right">Current %</th>
                <th class="text-right">Target %</th>
                <th class="text-right">Target Value</th>
                <th class="text-right">Difference</th>
                <th class="text-right">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in rebalance_data %}
            <tr>
                <td><strong>{{ item.asset_class }}</strong></td>
                <td class="text-right">${{ "%.2f"|format(item.current_value) }}</td>
                <td class="text-right">{{ "%.1f"|format(item.current_pct) }}%</td>
                <td class="text-right">{{ "%.1f"|format(item.target_pct) }}%</td>
                <td class="text-right">${{ "%.2f"|format(item.target_value) }}</td>
                <td class="text-right {% if item.difference > 0 %}positive{% elif item.difference < 0 %}negative{% endif %}">
                    ${{ "%.2f"|format(item.difference|abs) }}
                </td>
                <td class="text-right">
                    {% if item.difference > 1 %}
                    <span class="positive"><strong>BUY ${{ "%.2f"|format(item.difference) }}</strong></span>
                    {% elif item.difference < -1 %}
                    <span class="negative"><strong>SELL ${{ "%.2f"|format(item.difference|abs) }}</strong></span>
                    {% else %}
                    <span style="color: #7f8c8d;">HOLD</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Recommendations</h2>
    <ul style="line-height: 2;">
        {% for item in rebalance_data %}
            {% if item.difference > 1 %}
            <li><span class="positive">✓</span> <strong>Buy</strong> ${{ "%.2f"|format(item.difference) }} of <strong>{{ item.asset_class }}</strong> (currently {{ "%.1f"|format(item.current_pct) }}%, target {{ "%.1f"|format(item.target_pct) }}%)</li>
            {% elif item.difference < -1 %}
            <li><span class="negative">✗</span> <strong>Sell</strong> ${{ "%.2f"|format(item.difference|abs) }} of <strong>{{ item.asset_class }}</strong> (currently {{ "%.1f"|format(item.current_pct) }}%, target {{ "%.1f"|format(item.target_pct) }}%)</li>
            {% endif %}
        {% endfor %}
    </ul>
</div>

{% else %}
<div class="card">
    <p style="color: #7f8c8d;">No rebalancing data available. Make sure you have:</p>
    <ul style="margin-top: 1rem; color: #7f8c8d;">
        <li>Created at least one account with holdings</li>
        <li>Set your target allocation percentages</li>
    </ul>
    <div style="margin-top: 2rem;">
        <a href="{{ url_for('accounts') }}" class="btn btn-primary">Manage Accounts</a>
        <a href="{{ url_for('targets') }}" class="btn btn-primary">Set Targets</a>
    </div>
</div>
{% endif %}
{% endblock %}

